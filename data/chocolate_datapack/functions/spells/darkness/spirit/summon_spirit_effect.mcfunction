execute at @s as @e[tag=vengeful_spirit_summon] if score @s player_id = @e[tag=summon_spirit,limit=1,sort=nearest] player_id run kill @s

#Summon invisible mobs that control the summon
execute as @s[tag=lv1] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv1","new_spell"],Silent:1b}
execute as @s[tag=lv1] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv1","new_spell"],Silent:1b}
execute as @s[tag=lv1] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv1","new_spell"],Silent:1b}

execute as @s[tag=lv2] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv2","new_spell"],Silent:1b}
execute as @s[tag=lv2] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv2","new_spell"],Silent:1b}
execute as @s[tag=lv2] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv2","new_spell"],Silent:1b}
execute as @s[tag=lv2] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv2","new_spell"],Silent:1b}
execute as @s[tag=lv2] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv2","new_spell"],Silent:1b}
execute as @s[tag=lv2] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv2","new_spell"],Silent:1b}

execute as @s[tag=lv3] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv3","new_spell"],Silent:1b}
execute as @s[tag=lv3] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv3","new_spell"],Silent:1b}
execute as @s[tag=lv3] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv3","new_spell"],Silent:1b}
execute as @s[tag=lv3] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv3","new_spell"],Silent:1b}
execute as @s[tag=lv3] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv3","new_spell"],Silent:1b}
execute as @s[tag=lv3] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv3","new_spell"],Silent:1b}
execute as @s[tag=lv3] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv3","new_spell"],Silent:1b}
execute as @s[tag=lv3] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv3","new_spell"],Silent:1b}
execute as @s[tag=lv3] at @s run summon vex ~ ~-1 ~ {Attributes:[{Name:"generic.knockback_resistance",Base:100},{Name:"generic.attack_damage",Base:0},{Name:"generic.follow_range",Base:64},{Name:"generic.attack_speed",Base:0}],Tags:["vengeful_spirit_summon","summon","offensive","spirit","lv3","new_spell"],Silent:1b}

execute as @s[tag=lv1] at @s positioned ~ ~ ~ as @e[tag=vengeful_spirit_summon,distance=..3] run scoreboard players set @s kill_timer 200
execute as @s[tag=lv2] at @s positioned ~ ~ ~ as @e[tag=vengeful_spirit_summon,distance=..3] run scoreboard players set @s kill_timer 400
execute as @s[tag=lv3] at @s positioned ~ ~ ~ as @e[tag=vengeful_spirit_summon,distance=..3] run scoreboard players set @s kill_timer 600
execute at @s positioned ~ ~-1 ~ run effect give @e[type=vex,tag=new_spell,distance=..10] invisibility infinite 0 true

#initialize animation timer
execute as @s at @s positioned ~ ~-1 ~ as @e[tag=vengeful_spirit_summon,distance=..3] run scoreboard players set @s animation_cooldown 0
execute as @s at @s positioned ~ ~-1 ~ as @e[tag=vengeful_spirit_summon,distance=..3] run scoreboard players set @s summoned_target 0
#put player's spell ID on the spell
execute as @s at @s positioned ~ ~-1 ~ run scoreboard players operation @e[distance=..3,tag=vengeful_spirit_summon] player_id = @s player_id
#put player's team ID on the spell
execute as @s[scores={kill_timer=..1,team_id=1..}] at @s positioned ~ ~-1 ~ run scoreboard players operation @e[distance=..3,tag=vengeful_spirit_summon] team_id = @s team_id
# Remove 'new_spell' tag
execute at @s positioned ~ ~-1 ~ run tag @e[tag=vengeful_spirit_summon,sort=nearest,distance=..2,tag=new_spell] remove new_spell
kill @s